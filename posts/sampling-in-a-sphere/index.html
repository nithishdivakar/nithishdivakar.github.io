<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]}}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><title>Sampling in a Sphere | DAXPY</title><link rel=stylesheet href=/css/main.min.893c9340c957513598581780adb1395d937fd4885954ab6c67536bd4c77301a6.css integrity="sha256-iTyTQMlXUTWYWBeArbE5XZN/1IhZVKtsZ1Nr1MdzAaY=" crossorigin=anonymous><script src=/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js integrity="sha256-I80MfYNyY7nq65buLZzPopadqj+gD6HB/ocBqbhyUaE=" crossorigin=anonymous></script></head><body><header><nav><ul><li><a class=text_secondary href=https://daxpy.xyz/>DAXPY</a></li><li>|</li><li><a href=https://daxpy.xyz/posts/>Posts</a></li><li><a href=https://daxpy.xyz/notes/>Notes</a></li><li><a href=https://daxpy.xyz/links/>Links</a></li><li><a href=https://daxpy.xyz/stories/>Stories</a></li><li><a href=/about>About</a></li></ul></nav></header><main><section><article><h1 id=sampling-in-a-sphere>Sampling in a Sphere</h1><p>Understanding how to generate a uniform sample of points inside a sphere takes us through a few interesting topics. So let begin with the end in mind.</p><p>The following algorithm generates a uniform sample of points inside sphere in n dimensions.</p><p>$$u_1, \ldots, u_{n+2} \sim \mathcal{N}(0,1)$$
$$x_1, \ldots, x_n = \frac{(u_1,\ldots, u_n)}{\sqrt{u_1^2+\ldots+u_{n+2}^{2}}}$$</p><p>There is a lot to unpack here.</p><ul><li>Why are we sampling from a normal distribution to get a uniform distribution?</li><li>Why $n+2$ ?</li><li>Why are we dropping 2 coordinates?</li></ul><h2 id=what-is-inside-a-sphere>What is inside a Sphere?</h2><p>A sphere is defined as a set of points which are equidistant from a point known as center. For this article, we mostly deal with unit spheres. A unit n-sphere with center at origin can be defined as</p><p>$$S^n = \{x \in \mathbb{R}^{n} : \|x\| = 1\}$$</p><p>This includes only the periphery of the region. Or the circumference. An n-ball however is the whole region inside the n-sphere.</p><p>$$B^n = \{x \in \mathbb{R}^{n} : \|x\| \leq 1 \}$$</p><p>Note that the $B^n$ is a closed ball so $S^n \subset B^n$.</p><p>Some quick facts about the unit n-ball and n-sphere</p><ul><li>Both can be completely inscribed in the region $[-1,1]^n$</li><li><a href=https://en.wikipedia.org/wiki/Volume_of_an_n-ball title="Volume of an n ball">Volume of an n-ball</a> is given by $$\operatorname{vol}[B^n] = \frac{\pi^{n/2}}{\Gamma(\frac{n}{2}+1)}$$
This fomula simplyfies to $\pi r^2$ and $\frac{4}{3}\pi r^2$ for a circle and 3d sphere.</li></ul><h2 id=when-spheres-are-circles>When Spheres are Circles</h2><p>In 2 dimensions, there is simple technique get uniformly sampling points within a circle. Rejection sampling. Generate unifom random samples inside $[-1,1]^2$ and reject all the samples which are outside the circle.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
</span></span><span style=display:flex><span>  x <span style=color:#f92672>~</span> U[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>  y <span style=color:#f92672>~</span> U[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> x<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span><span style=color:#f92672>+</span> y<span style=color:#f92672>^</span><span style=color:#ae81ff>2</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (x,y)
</span></span></code></pre></div><p>However, efficiency of rejection sampling depends on how many samples are accepted; which is ratio of area of the circle to the area of the $2 \times 2$ square. and that about
$$\frac{\pi 1^2}{4} \approx 78.5\%$$</p><p>We can extend the technique for higher dimensions but it has a critical flaw. The curse of dimensionality. The efficiency of rejection sampling for generating uniform sampling of points for n-sphere is</p><p>$$\frac{\operatorname{vol}[B^n]}{2^{n}}$$</p><p>In 3 dimensions the efficiency drops to $\approx 52.33\%$ and by the time we get to 10 dimensions, its $ \frac{\pi^5/5!}{2^{10}} \approx 0.249\% $. i.e we end up rejecting $99.7\%$ of the generated points. It worse further up.</p><h2 id=on-the-circumference>On the circumference</h2><p>If we restrict ourselves to get uniform sampling of point on the circumference of the circle, there is an easier techqnique. The technique is an inversion of <a href=https://en.wikipedia.org/wiki/Marsaglia_polar_method title="Marsaglia's polar method">Marsaglia&rsquo;s polar method</a> for generating standard normal random numbers.</p><p>In 2D the technique is</p><p>$$u,v \sim \mathcal{N}(0,1)$$
$$x,y = \frac{u,v}{\sqrt{u^2+v^2}}$$</p><p>It seems a bit strange why this would generate random uniform points on the circle&rsquo;s circumference. Especially since we begin sampling from a normal distribution. But the proof is simple. Let take a look at the join distribution of $(u,v)$. Since both are normally distributed and independent of each other, we have</p><p>$$f(u,v) = \left(\frac{1}{\sqrt{2\pi}} e^{-\frac{1}{2}u^2}\right) \left(\frac{1}{\sqrt{2\pi}} e^{-\frac{1}{2}v^2}\right)$$
$$= \frac{1}{2\pi} e^{\frac{1}{2} (u^2+v^2)}$$</p><p>The joint distribution of $(u,v)$ only depends on its distance from origin ($u^2+v^2$) and is invariant to direction. The last step in the algorithm where we normalise both point by this distance projects all $(u,v)$&rsquo;s to the circle&rsquo;s circumference without any rotation. So they are uniformly distributed on the circle.</p><p>We can extend the proof to n-dimensions</p><p>$$f(u_1,\ldots, u_n) = \prod_i \left(\frac{1}{\sqrt{2\pi}} e^{-\frac{1}{2}u_i^2}\right) = \frac{1}{(2\pi)^{n/2}} e^{\frac{1}{2}\|u\|^2} $$
and so does the technique. Generating random uniform points on n-sphere is
$$u_i \sim \mathcal{N}(0,1) $$
$$ x = \frac{u}{\|u\|} $$</p><p>But what about generating uniformly sampled points inside the circle?</p><h2 id=from-circumference-to-the-center>From circumference to the center</h2><blockquote><p>Uniformly distributed points on an $S^{n+2}$ are uniformly distributed on $B^{n}$.</p></blockquote><p>This elegant results first observed by <a href=https://www.sciencedirect.com/science/article/pii/S0047259X10001211 title='Harman, Radoslav and Lacko, Vladim{&#39;\i}r "On decompositional algorithms for uniform sampling from n-spheres and n-balls" In Journal of Multivariate Analysis 101, (2010)'>Harman and Lacko</a> and later proved by <a href=https://compneuro.uwaterloo.ca/files/publications/voelker.2017.pdf title='Voelker, Aaron R and Gosmann, Jan and Stewart, Terrence C "Efficiently sampling vectors and coordinates from the n-sphere and n-ball" In Centre for Theoretical Neuroscience-Technical Report 1, (2017)'>Voelker et al. (2017)</a>. Following this result, we can generate uniform sampling of points in $B^n$ by first generating uniform sampling of points in $S^{n+2}$ and dropping (any) 2 coordinates.</p><p>$$u_1, \ldots, u_{n+2} \sim \mathcal{N}(0,1)$$
$$x_1, \ldots, x_n = \frac{(u_1,\ldots, u_n)}{\sqrt{u_1^2+\ldots+u_{n+2}^{2}}}$$</p><h2 id=-but-one-last-thing>&mldr; but one last thing</h2><p>There is one more technique which uses projection from n-sphere to get uniform sampling on points on n-ball. The key obsevation is that an n-ball is a collection of n-spheres of different radius
i.e $$ B^n[1] = \bigcup_{x=0}^{1} S^n[x]$$</p><p>So first we sample a point in $S^n[1]$ and then move the point somewhere between origin and circumference. But there is a catch. The area of $S^n[x]$ is proportional to $x^n$, so we have to normalize accordingly. So</p><p>$$u_1, \ldots, u_{n} \sim \mathcal{N}(0,1)$$
$$r \sim \operatorname{U}[0,1]$$
$$x = r^{1/n} \frac{u}{\|u\|}$$</p><h2 id=references>References</h2><reference><small><ul><li><p><a href=https://www.sciencedirect.com/science/article/pii/S0047259X10001211 title='Harman, Radoslav and Lacko, Vladim{&#39;\i}r "On decompositional algorithms for uniform sampling from n-spheres and n-balls" In Journal of Multivariate Analysis 101, (2010)'>Harman and Lacko (2010)</a>: Harman, Radoslav and Lacko, Vladim{'\i}r &ldquo;<em>On decompositional algorithms for uniform sampling from n-spheres and n-balls</em>&rdquo; In Journal of Multivariate Analysis 101, (2010)</p></li><li><p><a href=https://compneuro.uwaterloo.ca/files/publications/voelker.2017.pdf title='Voelker, Aaron R and Gosmann, Jan and Stewart, Terrence C "Efficiently sampling vectors and coordinates from the n-sphere and n-ball" In Centre for Theoretical Neuroscience-Technical Report 1, (2017)'>Voelker et al. (2017)</a>: Voelker, Aaron R and Gosmann, Jan and Stewart, Terrence C &ldquo;<em>Efficiently sampling vectors and coordinates from the n-sphere and n-ball</em>&rdquo; In Centre for Theoretical Neuroscience-Technical Report 1, (2017)</p></li><li><p><em><a href=https://en.wikipedia.org/wiki/Marsaglia_polar_method title="Marsaglia's polar method">Marsaglia polar method</a></em><br><small><em><code>https://en.wikipedia.org/wiki/Marsaglia_polar_method</code></em></small></p></li><li><p><em><a href=https://en.wikipedia.org/wiki/Volume_of_an_n-ball title="Volume of an n ball">Volume of an n ball</a></em><br><small><em><code>https://en.wikipedia.org/wiki/Volume_of_an_n-ball</code></em></small></p></li></ul></small></reference></article><br><br><br><i>tags:</i>
<a class=gray style=padding-right:5px href=/tags#statistics><i>#statistics</i></a>
<a class=gray style=padding-right:5px href=/tags#probability><i>#probability</i></a></section></main><footer><p>Found something useful here? pass it on; or tell me about it!<nav><ul><li><a href="https://drive.google.com/drive/folders/18LU6PKnxy8rDrAXhpiPXV2yOYlO_I8cF?usp=sharing">Resume</a></li><li><a href=https://daxpy.xyz/omnia_mea>Coding notes</a></li><li><a href=https://www.linkedin.com/in/ndivakar/>Linkedin</a></li></ul></nav><small><a href=#top>↑ Top of page</a></small></p></footer></body></html>